<%- include("../../views/partials/user/header") %>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
 
    
    /* .product-entry {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
     */
    .prod-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .desc {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .product-name {
        margin-bottom: 15px;
        padding-left: 15px;
        font-size: 15px;
        height: 40px;
        overflow: hidden;
    }
    .price-cart {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .price {
        color: #e74c3c;
        font-weight: bold;
        margin-bottom: 10px;   
    }
    /* .add-to-cart-btn {
        background-color:rgb(236, 78, 78);
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s;
        width: 100%;
    }
    .add-to-cart-btn:hover {
        background-color: #45a049;
    } */

.product-content-wrap h5 {
    font-size: 16px;
    color: #ff6b6b;
    margin-bottom: 5px; 
}

.product-content-wrap .btn {
    background-color: #ff6b6b;
    color: white;
    padding: 8px 8px; 
    border-radius: 5px;
    text-transform: uppercase;
    font-size:10px;
    transition: background-color 0.3s ease;
    margin-top: 5px; 
}

.product-content-wrap .btn:hover {
    background-color: #ff4c4c;
}

 @media (max-width: 768px) {
    .product-item {
        width: calc(50% - 20px); 
    }
}

@media (max-width: 480px) {
    .product-item {
        width: 100%;
    }
} 

.product-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
    }
       
.product-grid:only-child {
    justify-content: left;
}

.product-grid > .product-item {
    width: calc(25% - 20px);
    margin-bottom: 30px;
}
    .product-item {
        position: relative; 
        width: calc(25% - 20px);
        margin-bottom: 30px;
        display: flex;
        flex-direction: column;
    }

    .product-entry {
        border: 1px solid #ddd;
        padding: 10px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .prod-img {
        position: relative;
        height: 200px;
        overflow: hidden;
    }

    .prod-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .wishlist-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(255, 255, 255, 0.7); 
        padding: 8px;
        border-radius: 50%;
        color: #ff6b6b;
        font-size: 18px;
        z-index: 10;
        transition: background-color 0.3s, color 0.3s;
    }

    .wishlist-btn:hover {
        background-color: rgba(255, 255, 255, 1);
        color: #ff4c4c;
    }
</style>

<div class="breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col">
                <p class="bread"><span><a href="/">Home</a></span> / <span>Offers</span></p>
            </div>
        </div>
    </div>
</div>

<div class="breadcrumbs-two">
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="breadcrumbs-img" style="background-image: url(images/cover-img-1.jpg);">
                    <h2>Offers</h2>
                </div>
                <div class="menu text-center">
                    <p><a href="#">New Arrivals</a> <a href="#">Best Sellers</a> <a href="#">Extended Widths</a> <a href="#">Sale</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="colorlib-featured">
    <div class="container">
        <div class="row">
            <div class="col-sm-4 text-center">
                <div class="featured">
                    <div class="featured-img featured-img-2" style="background-image: url(images/img_bg_2.jpg);">
                        <h2>Casuals</h2>
                        <p><a href="#" class="btn btn-primary btn-lg">Shop now</a></p>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 text-center">
                <div class="featured">
                    <div class="featured-img featured-img-2" style="background-image: url(images/women.jpg);">
                        <h2>Dress</h2>
                        <p><a href="#" class="btn btn-primary btn-lg">Shop now</a></p>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 text-center">
                <div class="featured">
                    <div class="featured-img featured-img-2" style="background-image: url(images/item-11.jpg);">
                        <h2>Sports</h2>
                        <p><a href="#" class="btn btn-primary btn-lg">Shop now</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="colorlib-product">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-xl-3">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="side border mb-1">
                            <h3>Advanced Search</h3>
                            <form action="/offer" method="GET">
                                <div class="form-group">
                                    <label for="search">Search:</label>
                                    <input type="text" class="form-control" id="search" name="search" value="<%= search %>">
                                </div>
                                <div class="form-group">
                                    <label for="minPrice">Min Price:</label>
                                    <input type="number" class="form-control" id="minPrice" name="minPrice" value="<%= minPrice %>">
                                </div>
                                <div class="form-group">
                                    <label for="maxPrice">Max Price:</label>
                                    <input type="number" class="form-control" id="maxPrice" name="maxPrice" value="<%= maxPrice %>">
                                </div>
                                <div class="form-group">
                                    <label for="category">Category:</label>
                                    <select class="form-control" id="category" name="category">
                                        <option value="">All Categories</option>
                                        <% categories.forEach(cat => { %>
                                            <option value="<%= cat._id %>" <%= category === cat._id.toString() ? 'selected' : '' %>><%= cat.name %></option>
                                        <% }) %>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Search</button>
                            </form>
                        </div>
                    </div>
                    <!-- <div class="col-sm-12">
                        <div class="side border mb-1">
                            <h3>Brand</h3>
                            <ul>
                                <li><a href="#">Nike</a></li>
                                <li><a href="#">Adidas</a></li>
                                <li><a href="#">Merrel</a></li>
                                <li><a href="#">Gucci</a></li>
                                <li><a href="#">Skechers</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="side border mb-1">
                            <h3>Size</h3>
                            <div class="block-26 mb-2">
                                <ul>
                                    <li><a href="#">4</a></li>
                                    <li><a href="#">5</a></li>
                                    <li><a href="#">6</a></li>
                                    <li><a href="#">7</a></li>
                                    <li><a href="#">8</a></li>
                                    <li><a href="#">9</a></li>
                                </ul>
                            </div>
                        </div>
                    </div> -->
                   
                    <!-- <div class="col-sm-12">
                        <div class="side border mb-1">
                            <h3>Colors</h3>
                            <ul>
                                <li><a href="#">Black</a></li>
                                <li><a href="#">White</a></li>
                                <li><a href="#">Blue</a></li>
                                <li><a href="#">Red</a></li>
                                <li><a href="#">Green</a></li>
                                <li><a href="#">Grey</a></li>
                                <li><a href="#">Orange</a></li>
                                <li><a href="#">Cream</a></li>
                                <li><a href="#">Brown</a></li>
                            </ul>
                        </div>
                    </div> -->
                </div>
            </div>
            <div class="col-lg-9 col-xl-9">
                <!-- Sorting Form -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <form id="sortForm" class="form-inline" method="GET" action="/offer">
                            <input type="hidden" name="search" value="<%= search %>">
                            <input type="hidden" name="minPrice" value="<%= minPrice %>">
                            <input type="hidden" name="maxPrice" value="<%= maxPrice %>">
                            <input type="hidden" name="category" value="<%= category %>">
                            <select name="sort" id="sortSelect" class="form-control" onchange="document.getElementById('sortForm').submit();">
                                <option value="">Sort By</option>
                                <option value="popularity" <%= sort === 'popularity' ? 'selected' : '' %>>Popularity</option>
                                <option value="priceAsc" <%= sort === 'priceAsc' ? 'selected' : '' %>>Price: Low to High</option>
                                <option value="priceDesc" <%= sort === 'priceDesc' ? 'selected' : '' %>>Price: High to Low</option>
                                <option value="rating" <%= sort === 'rating' ? 'selected' : '' %>>Average Rating</option>
                                <option value="featured" <%= sort === 'featured' ? 'selected' : '' %>>Featured</option>
                                <option value="newArrivals" <%= sort === 'newArrivals' ? 'selected' : '' %>>New Arrivals</option>
                                <option value="aToZ" <%= sort === 'aToZ' ? 'selected' : '' %>>A - Z</option>
                                <option value="zToA" <%= sort === 'zToA' ? 'selected' : '' %>>Z - A</option>
                            </select>
                        </form>
                    </div>
                </div>
                
                <!-- Products Listing -->            
                
				<div class="product-grid">
                    <% if (products && products.length > 0) { %>
                        <% products.forEach(product => { %>
                            <div class="product-item">
                                <div class="product-entry border">
                                    <a href="/product-details/<%= product._id %>" class="prod-img">
                                        <img src="/uploads/product-images/<%= product.productImage[0] %>" alt="<%= product.productName %>">
                                    </a>
                                    <!-- <a href="/wishlist/<%= product._id %>" class="wishlist-btn">
                                        <i class="fas fa-heart"></i>
                                    </a> -->
                                    
                                    <div class="desc">
                                        <h5 class="product-name">
                                            <a href="/product-details/<%= product._id %>"><%= product.productName %></a>
                                        </h5>
                                        <!-- <div class="price-cart"> -->
                                            <!-- <span class="price">₹<%= product.salePrice %></span> -->
                                            <!-- <del class="price">₹<%= product.salePrice %></del> 
									        <span class="price">₹<%= product.offerPrice %></span> -->

                                        <!-- </div> -->
                                        <span class="price">
                                          <% if (product.offerPrice && product.offerPrice < product.salePrice) { %>								 
                                            <span class="money" style="text-decoration: line-through;">₹<%= product.regularPrice %></span>
                                            <span class="money" style="color: red; font-weight: bold;">₹<%= product.offerPrice %></span>
                                          <% } else if (product.salePrice < product.regularPrice) { %>
                                           
                                            <span class="money" style="text-decoration: line-through;">₹<%= product.regularPrice %></span>
                                            <span class="money" style="color: red; font-weight: bold;">₹<%= product.salePrice %></span>
                                          <% } else if (product.salePrice === product.regularPrice && product.offerPrice && product.offerPrice < product.salePrice) { %>
                                            
                                            <span class="money" style="text-decoration: line-through;">₹<%= product.regularPrice %></span>
                                            <span class="money" style="color: red; font-weight: bold;">₹<%= product.offerPrice %></span>
                                          <% } else { %>
                                          
                                            <span class="money">₹<%= product.regularPrice %></span>
                                          <% } %></span>
                                    </div>
                                    <a href="javascript:void(0)" onclick="addToWishlist('<%= product._id %>')" class="wishlist-btn">
                                        <i class="fa-regular fa-heart heart-icon" style="    display: inline-flex;"></i>
                                    </a>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p>No products found</p>
                    <% } %>
                </div>
                
				 <!-- Pagination -->
                 <div class="row">
                    <div class="col">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <% for (let i = 1; i <= totalPages; i++) { %>
                                    <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                        <a class="page-link" href="/offer?page=<%= i %>&search=<%= search %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>&category=<%= category %>&sort=<%= sort %>"><%= i %></a>
                                    </li>
                                <% } %>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
		

		<div class="colorlib-partner">
			<div class="container">
				<div class="row">
					<div class="col-sm-8 offset-sm-2 text-center colorlib-heading colorlib-heading-sm">
						<h2>Trusted Partners</h2>
					</div>
				</div>
				<div class="row">
					<div class="col partner-col text-center">
						<img src="images/brand-1.jpg" class="img-fluid" alt="Free html4 bootstrap 4 template">
					</div>
					<div class="col partner-col text-center">
						<img src="images/brand-2.jpg" class="img-fluid" alt="Free html4 bootstrap 4 template">
					</div>
					<div class="col partner-col text-center">
						<img src="images/brand-3.jpg" class="img-fluid" alt="Free html4 bootstrap 4 template">
					</div>
					<div class="col partner-col text-center">
						<img src="images/brand-4.jpg" class="img-fluid" alt="Free html4 bootstrap 4 template">
					</div>
					<div class="col partner-col text-center">
						<img src="images/brand-5.jpg" class="img-fluid" alt="Free html4 bootstrap 4 template">
					</div>
				</div>
			</div>
		</div>

		<%-include("../../views/partials/user/footer")%>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

		
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const productGrid = document.querySelector('.product-grid');
        const productItems = productGrid.children.length;

        if (productItems <= 2) {
            productGrid.style.justifyContent = 'center';
        }
    });
</script>

<script>
    async function addToWishlist(productId) {
    try {
       
        const response = await fetch('/wishlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ productId }),
        });

        
        if (response.ok) {
            const result = await response.json();
            
            
            Swal.fire({
                title: 'Added to Wishlist!',
                text: result.message || 'The product was added to your wishlist.',
                icon: 'success',
                confirmButtonText: 'Continue Shopping',
                timer: 3000,
                timerProgressBar: true,
            });
        } else {
          
            Swal.fire({
                title: 'Error',
                text: 'Error adding product to wishlist',
                icon: 'error',
                confirmButtonText: 'Try Again'
            });
        }
    } catch (error) {
        console.error('Error adding to wishlist:', error);
       
        Swal.fire({
            title: 'Error',
            text: 'An error occurred. Please try again later.',
            icon: 'error',
            confirmButtonText: 'OK'
        });
    }
}
</script>

 